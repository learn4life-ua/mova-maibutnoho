<!DOCTYPE html>
<html lang="uk" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö–≤–µ—Å—Ç ¬´–ó–±–µ—Ä–∏ –º—É–¥—Ä—ñ—Å—Ç—å¬ª ‚Äî –ú–æ–≤–∞ –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ</title>
  <meta name="description" content="–ü–∞–∑–ª —ñ–∑ –ø—Ä–∏—Å–ª—ñ–≤‚Äô—ó–≤ —ñ —Ñ—Ä–∞–∑–µ–æ–ª–æ–≥—ñ–∑–º—ñ–≤: —Å–∫–ª–∞–¥–∞–π —Ä–æ–∑—Å–∏–ø–∞–Ω—ñ —Å–ª–æ–≤–∞ —É –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É –π –¥—ñ–∑–Ω–∞–≤–∞–π—Å—è –ø–æ—è—Å–Ω–µ–Ω–Ω—è." />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    /* VARIABLES (–ó–±–µ—Ä–µ–∂–µ–Ω–æ –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ) */
    :root{--blue:#2563eb;--blue-dark:#1E3A5F;--gray-bg:#F5F7FA;--text:#1f2937;--ok:#16a34a;--warn:#ef4444}
    html,body{height:100%}
    body{font-family:Inter,system-ui,Arial,sans-serif;background:var(--gray-bg);color:var(--text)}
    
    /* CORE COMPONENTS */
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:1rem;box-shadow:0 10px 22px rgba(0,0,0,.08)}
    .chip{display:inline-flex;align-items:center;gap:.5rem;padding:.35rem .7rem;border-radius:999px;border:1px solid #e5e7eb;background:#fff}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;padding:.8rem 1.1rem;border-radius:.9rem;border:1px solid transparent;font-weight:600;letter-spacing:.01em;transition:transform .12s,box-shadow .12s,filter .12s}
    .btn:focus{outline:2px solid transparent;outline-offset:2px;box-shadow:0 0 0 3px rgba(37,99,235,.35)}
    .btn:hover{transform:translateY(-1px)}
    .btn-primary{background:var(--blue);color:#fff;box-shadow:0 6px 16px rgba(37,99,235,.25)}
    .btn-primary:hover{filter:brightness(1.05)}
    .btn-dark{background:#0f172a;color:#fff;box-shadow:0 6px 16px rgba(15,23,42,.3)}
    .btn-dark:hover{filter:brightness(1.05)}
    .btn:disabled{opacity:.6;cursor:not-allowed;transform:none;box-shadow:none}
    
    /* GAME TOKENS */
    .token{user-select:none;cursor:pointer;border-radius:.7rem;border:1px solid #e5e7eb;background:#f9fafb;padding:.45rem .7rem;transition:.12s}
    .token:hover{transform:translateY(-1px); background-color: #f3f4f6;}
    .token.lock{background:#e5f7ef;border-color:#cceadf;cursor:default}
    .token.bad{background:#fff1f2;border-color:#fecaca; animation: shake 0.3s;}
    .token.first{background:#dbeafe;border-color:#60a5fa;font-weight:600}

    /* –ê–Ω—ñ–º–∞—Ü—ñ—è —Ö–∏—Ç–∞–Ω–Ω—è –¥–ª—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ */
    @keyframes shake {
      0% { transform: translateX(0); }
      20% { transform: translateX(-5px); }
      40% { transform: translateX(5px); }
      60% { transform: translateX(-5px); }
      80% { transform: translateX(5px); }
      100% { transform: translateX(0); }
    }
  </style>
</head>
<body class="flex flex-col min-h-screen">
  
  <!-- –•–ï–î–ï–† –ó –§–õ–ï–®-–ö–ê–†–¢–û–ö -->
  <header class="bg-gradient-to-r from-[#1E3A5F] to-[#4BA3C3] text-white p-4 shadow-xl sticky top-0 z-50">
    <nav class="max-w-4xl mx-auto flex justify-between items-center">
      <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞ –≥–æ–ª–æ–≤–Ω—É" –∑ —ñ–∫–æ–Ω–∫–æ—é SVG -->
      <a href="https://learn4life-ua.github.io/mova-maibutnoho" class="inline-flex items-center gap-2 text-white no-underline font-semibold text-sm sm:text-base hover:opacity-85 transition-opacity">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5"></path>
          <path d="M12 19l-7-7 7-7"></path>
        </svg>
        –ù–∞ –≥–æ–ª–æ–≤–Ω—É
      </a>
      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—ñ–±–Ω–∏–∫–∞ -->
      <div class="text-xs sm:text-sm opacity-80 hidden sm:block">
        –ü–æ—Å—ñ–±–Ω–∏–∫: <strong class="text-white">–ú–æ–≤–∞ –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ</strong>
      </div>
    </nav>
  </header>

  <main class="max-w-4xl mx-auto px-4 py-8 flex-grow">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–≤–µ—Å—Ç—É –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ –æ—Å–Ω–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—ñ–∑—É–∞–ª—å–Ω–æ–≥–æ –µ—Ñ–µ–∫—Ç—É -->
    <h1 class="text-[clamp(1.8rem,3vw+1rem,2.5rem)] font-extrabold text-[#1E3A5F] mb-4 tracking-tight text-center">
        –ö–≤–µ—Å—Ç ¬´–ó–±–µ—Ä–∏ –º—É–¥—Ä—ñ—Å—Ç—å¬ª
    </h1>
    <p class="text-lg text-gray-700 max-w-3xl mx-auto mb-6 text-center">
        –°–∫–ª–∞–¥–∏ —Ä–æ–∑—Å–∏–ø–∞–Ω—ñ —Å–ª–æ–≤–∞ —É –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É. –ü—ñ—Å–ª—è —Ä–æ–∑–≤‚Äô—è–∑–∞–Ω–Ω—è ‚Äî –∫–æ—Ä–æ—Ç–∫–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è.
    </p>

    <section class="card p-4 md:p-6 mb-6">
      <div class="flex flex-wrap items-center justify-between gap-3">
        <div class="flex flex-wrap items-center gap-2">
          <span class="chip"><b>–†—ñ–≤–µ–Ω—å:</b> <span id="levelChip">0 / 10</span></span>
          <span class="chip"><b>–°–ø—Ä–æ–±–∏:</b> <span id="triesChip">0</span></span>
          <span class="chip"><b>–û—á–∫–∏:</b> <span id="scoreChip">0</span></span>
        </div>
        <div class="flex flex-wrap items-center gap-2">
          <button id="shuffleBtn" class="btn bg-gray-200 hover:bg-gray-300 text-gray-800" title="–ü–µ—Ä–µ–º—ñ—à–∞—Ç–∏ —Å–ª–æ–≤–∞">üîÄ –ü–µ—Ä–µ–º—ñ—à–∞—Ç–∏</button>
          <button id="hintBtn" class="btn bg-yellow-400 hover:bg-yellow-500 text-gray-800" title="–ü—ñ–¥–∫–∞–∑–∫–∞ (–ø—ñ—Å–ª—è 2 –ø–æ–º–∏–ª–æ–∫)" disabled>üí° –ü—ñ–¥–∫–∞–∑–∫–∞</button>
          <button id="restartBtn" class="btn bg-red-500 hover:bg-red-600 text-white" title="–ü–æ—á–∞—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É">‚ü≤ –ü–æ—á–∞—Ç–∏ –∑–∞–Ω–æ–≤–æ</button>
        </div>
      </div>
    </section>

    <section class="card p-4 md:p-6" id="taskArea" aria-live="polite">
      <h2 class="text-xl font-semibold text-gray-700">–ó–±–µ—Ä–∏ –≤–∏—Å–ª—ñ–≤</h2>
      <div class="mt-4">
        <p class="text-sm text-gray-500 mb-2">–ù–∞—Ç–∏—Å–Ω–∏ –Ω–∞ —Å–ª–æ–≤–∞, —â–æ–± –∑—ñ–±—Ä–∞—Ç–∏ –≤–∏—Å–ª—ñ–≤:</p>
        <div id="pool" class="flex flex-wrap gap-2 min-h-[50px] p-2 bg-gray-50 rounded-lg border border-gray-200"></div>
      </div>

      <div class="mt-4">
        <p class="text-sm text-gray-500 mb-2">–ó—ñ–±—Ä–∞–Ω–∏–π –≤–∏—Å–ª—ñ–≤:</p>
        <div id="assembled" class="flex flex-wrap gap-2 p-3 rounded-lg bg-white border-2 border-dashed border-blue-300 min-h-[56px]"></div>
      </div>

      <div class="mt-4 flex flex-wrap items-center gap-2">
        <button id="checkBtn" class="btn btn-primary">‚úî –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
        <button id="nextBtn" class="btn btn-dark" disabled>‚Üí –î–∞–ª—ñ</button>
      </div>

      <div id="feedback" class="mt-3 hidden p-3 rounded-lg text-sm transition-all duration-300"></div>
      <div id="explain" class="mt-3 hidden p-3 rounded-lg bg-blue-50 border border-blue-200 text-blue-900 text-sm"></div>
    </section>
  </main>

  <!-- –§–£–¢–ï–† –ó –§–õ–ï–®-–ö–ê–†–¢–û–ö -->
  <footer class="text-center p-6 mt-auto text-xs text-gray-500 bg-white border-t border-gray-200">
    ¬© 2025 –í–°–ü ¬´–ê–≥—Ä–∞—Ä–Ω–æ-–µ–∫–æ–Ω–æ–º—ñ—á–Ω–∏–π —Ñ–∞—Ö–æ–≤–∏–π –∫–æ–ª–µ–¥–∂ –ü–î–ê–£¬ª. –ü—Ä–æ—î–∫—Ç ¬´–ú–æ–≤–∞ –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ¬ª.
  </footer>

  <script>
    const LEVELS = [
      { text:'–í–µ–ª–∏–∫–∞ —Ä–∏–±–∞ –º–∞–ª—É –∫–æ–≤—Ç–∞—î', explain:'–ü—Ä–æ –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ñ—Å—Ç—å, –∫–æ–ª–∏ —Å–∏–ª—å–Ω—ñ –ø—Ä–∏–≥–Ω—ñ—á—É—é—Ç—å —Å–ª–∞–±—à–∏—Ö.' },
      { text:'–°—ñ–º —Ä–∞–∑ –≤—ñ–¥–º—ñ—Ä—è–π –æ–¥–∏–Ω —Ä–∞–∑ –≤—ñ–¥—Ä—ñ–∂', explain:'–ü–µ—Ä—à –Ω—ñ–∂ –¥—ñ—è—Ç–∏, –¥–æ–±—Ä–µ –≤—Å–µ –æ–±–¥—É–º–∞–π, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–æ–∫.' },
      { text:'–ù–∞ –≥–æ—Ä–æ–¥—ñ –±—É–∑–∏–Ω–∞ –∞ –≤ –ö–∏—î–≤—ñ –¥—è–¥—å–∫–æ', explain:'–ü—Ä–æ –Ω–µ–¥–æ—Ä–µ—á–Ω—ñ, –Ω–µ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ –º—ñ–∂ —Å–æ–±–æ—é —Ä–µ—á—ñ –∞–±–æ —Ä–æ–∑–º–æ–≤—É –Ω—ñ –ø—Ä–æ —â–æ.' },
      { text:'–Ø–∑–∏–∫ –¥–æ –ö–∏—î–≤–∞ –¥–æ–≤–µ–¥–µ', explain:'–Ø–∫—â–æ –ø–∏—Ç–∞—Ç–∏ –¥–æ—Ä–æ–≥—É, —Ç–æ –º–æ–∂–Ω–∞ –¥—ñ—Å—Ç–∞—Ç–∏—Å—è –∫—É–¥–∏ –∑–∞–≤–≥–æ–¥–Ω–æ. –ü—Ä–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è.' },
      { text:'–ù–µ –∫–∞–∂–∏ –≥–æ–ø –ø–æ–∫–∏ –Ω–µ –ø–µ—Ä–µ—Å–∫–æ—á–∏—à', explain:'–ù–µ –≤–∞—Ä—Ç–æ —Ö–≤–∞–ª–∏—Ç–∏—Å—è —É—Å–ø—ñ—Ö–æ–º –¥–æ —Ç–æ–≥–æ, —è–∫ –≤—ñ–Ω —Å—Ç–∞–≤—Å—è.' },
      { text:'–ü—ñ–¥ –ª–µ–∂–∞—á–∏–π –∫–∞–º—ñ–Ω—å –≤–æ–¥–∞ –Ω–µ —Ç–µ—á–µ', explain:'–£—Å–ø—ñ—Ö –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –¥–æ —Ç–æ–≥–æ, —Ö—Ç–æ –¥—ñ—î, –∞ –Ω–µ —Å–∏–¥–∏—Ç—å —Å–∫–ª–∞–≤—à–∏ —Ä—É–∫–∏.' },
      { text:'–ë–µ–∑ —Ç—Ä—É–¥–∞ –Ω–µ–º–∞ –ø–ª–æ–¥–∞', explain:'–ù—ñ—á–æ–≥–æ –Ω–µ –¥–∞—î—Ç—å—Å—è –ª–µ–≥–∫–æ, –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –ø–æ—Ç—Ä—ñ–±–Ω—ñ –∑—É—Å–∏–ª–ª—è.' },
      { text:'–°–ª–æ–≤–æ –Ω–µ –≥–æ—Ä–æ–±–µ—Ü—å –≤–∏–ª–µ—Ç–∏—Ç—å –Ω–µ —Å–ø—ñ–π–º–∞—î—à', explain:'–ü—Ä–æ –≤–∞–∂–ª–∏–≤—ñ—Å—Ç—å –æ–±–¥—É–º—É–≤–∞—Ç–∏ —Å–≤–æ—ó —Å–ª–æ–≤–∞, –±–æ —Å–∫–∞–∑–∞–Ω–µ –Ω–µ –º–æ–∂–Ω–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏.' },
      { text:'–ö—É–π –∑–∞–ª—ñ–∑–æ –ø–æ–∫–∏ –≥–∞—Ä—è—á–µ', explain:'–¢—Ä–µ–±–∞ –¥—ñ—è—Ç–∏ –æ–¥—Ä–∞–∑—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å–ø—Ä–∏—è—Ç–ª–∏–≤–∏–π –º–æ–º–µ–Ω—Ç.' },
      { text:'–ü—Ä–∞–≤–¥–∞ —è–∫ –æ–ª—ñ—è –∑–∞–≤–∂–¥–∏ –Ω–∞–≥–æ—Ä—É —Å–ø–ª–∏–≤–µ', explain:'–ü—Ä–æ —Ç–µ, —â–æ –ø—Ä–∏—Ö–æ–≤—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–¥—É –º–∞—Ä–Ω–æ, –≤–æ–Ω–∞ –∑–∞–≤–∂–¥–∏ —Ä–æ–∑–∫—Ä–∏—î—Ç—å—Å—è.' }
    ];

    let currentLevelIndex = 0;
    let score = 0;
    let tries = 0;
    let canCheck = true; // –ó–∞–ø–æ–±—ñ–≥–∞—î –ø–æ–¥–≤—ñ–π–Ω–æ–º—É –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—é –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
    let hintUsed = false;

    const levelChip = document.getElementById('levelChip');
    const triesChip = document.getElementById('triesChip');
    const scoreChip = document.getElementById('scoreChip');
    const poolEl = document.getElementById('pool');
    const asmEl = document.getElementById('assembled');
    const checkBtn = document.getElementById('checkBtn');
    const nextBtn = document.getElementById('nextBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const hintBtn = document.getElementById('hintBtn');
    const restartBtn = document.getElementById('restartBtn');
    const feedbackEl = document.getElementById('feedback');
    const explainEl = document.getElementById('explain');

    const HINT_AFTER_TRIES = 2; // –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–± –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –ø—ñ–¥–∫–∞–∑–∫–∏

    // --- –£—Ç–∏–ª—ñ—Ç–∏ ---
    function tokenise(s){ return s.split(/\s+/).filter(Boolean); }
    function shuffle(a){ for(let j=a.length-1;j>0;j--){ const k=Math.floor(Math.random()*(j+1)); [a[j],a[k]]=[a[k],a[j]]; } return a; }
    
    // --- –û–Ω–æ–≤–ª–µ–Ω–Ω—è UI ---
    function updateStats() {
      levelChip.textContent = `${currentLevelIndex + 1} / ${LEVELS.length}`;
      triesChip.textContent = tries;
      scoreChip.textContent = score;

      // –õ–æ–≥—ñ–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –ø—ñ–¥–∫–∞–∑–∫–∏
      if (tries >= HINT_AFTER_TRIES) {
        hintBtn.disabled = false;
        hintBtn.classList.remove('bg-gray-400', 'text-gray-500');
        hintBtn.classList.add('bg-yellow-400', 'hover:bg-yellow-500', 'text-gray-800');
      } else {
        hintBtn.disabled = true;
        hintBtn.classList.add('bg-gray-400', 'text-gray-500');
        hintBtn.classList.remove('bg-yellow-400', 'hover:bg-yellow-500', 'text-gray-800');
      }
    }

    function makeChip(word) {
      const d = document.createElement('button');
      d.className = 'token';
      d.textContent = word;
      d.dataset.word = word; // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Å–ª–æ–≤–æ —É –¥–∞—Ç–∞-–∞—Ç—Ä–∏–±—É—Ç—ñ

      // –î–æ–¥–∞—î–º–æ –∫–ª–∞—Å –¥–ª—è –ø–µ—Ä—à–æ–≥–æ —Å–ª–æ–≤–∞ (—è–∫—â–æ –≤–æ–Ω–æ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ –≤–µ–ª–∏–∫–æ—ó –ª—ñ—Ç–µ—Ä–∏)
      if (/^[–ê-–Ø–á–Ü–Ñ]/.test(word)) {
        d.classList.add('first');
      }

      // –ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è —Å–ª–æ–≤–∞ –º—ñ–∂ pool —Ç–∞ assembled
      d.onclick = () => { 
        if (!canCheck) return; // –ë–ª–æ–∫—É—î–º–æ, —è–∫—â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤–∂–µ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∞
        
        // –û—á–∏—â–∞—î–º–æ –≤—Å—ñ –∫–ª–∞—Å–∏ –ø–æ–º–∏–ª–æ–∫ –ø—Ä–∏ –∫–ª—ñ–∫—É
        Array.from(asmEl.children).forEach(token => token.classList.remove('bad'));

        if (d.parentElement === poolEl) {
          asmEl.appendChild(d);
        } else {
          // –©–æ–± –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ —Å–ª–æ–≤–æ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–µ –º—ñ—Å—Ü–µ –≤ pool, 
          // —Ç–∏–º—á–∞—Å–æ–≤–æ –ø–µ—Ä–µ–º—ñ—â—É—î–º–æ –π–æ–≥–æ –≤ –ø–∞–º'—è—Ç—å —ñ –∑–Ω–∞—Ö–æ–¥–∏–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–µ –º—ñ—Å—Ü–µ
          // (–°–æ—Ä—Ç—É—î–º–æ –ª–µ–∫—Å–∏–∫–æ–≥—Ä–∞—Ñ—ñ—á–Ω–æ –¥–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è)
          const sibling = Array.from(poolEl.children).find(
            (el) => el.textContent.localeCompare(d.textContent) > 0
          );
          if (sibling) {
            poolEl.insertBefore(d, sibling);
          } else {
            poolEl.appendChild(d);
          }
        }
        checkBtn.disabled = asmEl.children.length === 0; // –ë–ª–æ–∫—É—î–º–æ –∫–Ω–æ–ø–∫—É, —è–∫—â–æ –ø–æ–ª–µ –ø–æ—Ä–æ–∂–Ω—î
      };
      return d;
    }

    // --- –õ–æ–≥—ñ–∫–∞ –≥—Ä–∏ ---
    function drawLevel() {
      if (currentLevelIndex >= LEVELS.length) {
        showFinalScore();
        return;
      }
      
      canCheck = true;
      hintUsed = false;
      const { text } = LEVELS[currentLevelIndex];
      const words = tokenise(text);
      const mixed = shuffle([...words]);
      
      poolEl.innerHTML = '';
      asmEl.innerHTML = '';
      feedbackEl.classList.add('hidden');
      explainEl.classList.add('hidden');
      nextBtn.disabled = true;
      checkBtn.disabled = true;
      
      // –°—Ç–≤–æ—Ä—é—î–º–æ —Ñ—ñ—à–∫–∏
      mixed.forEach(w => poolEl.appendChild(makeChip(w)));

      updateStats();
    }

    function checkAnswer() {
      if (!canCheck) return;
      
      const userWords = Array.from(asmEl.children).map(c => c.textContent);
      const correctWords = tokenise(LEVELS[currentLevelIndex].text);
      const userSentence = userWords.join(' ');
      const correctSentence = correctWords.join(' ');

      // –°–∫–∏–¥–∞–Ω–Ω—è –∫–ª–∞—Å—ñ–≤ –ø–æ–º–∏–ª–æ–∫
      Array.from(asmEl.children).forEach(token => token.classList.remove('bad'));

      if (userSentence.trim() === correctSentence.trim()) {
        // --- –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å ---
        canCheck = false;
        
        // –§—ñ–∫—Å—É—î–º–æ —Å–ª–æ–≤–∞, –¥–æ–¥–∞—é—á–∏ –∫–ª–∞—Å lock
        Array.from(asmEl.children).forEach(token => {
          token.classList.add('lock');
          token.classList.remove('bad');
          token.onclick = null; // –í–∏–º–∏–∫–∞—î–º–æ –∫–ª—ñ–∫
        });

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–≥—É–∫—É
        feedbackEl.innerHTML = `‚úÖ **–°—É–ø–µ—Ä!** –í–∏ —Å–∫–ª–∞–ª–∏ –≤–∏—Å–ª—ñ–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ. (+${hintUsed ? 5 : 10} –æ—á–æ–∫)`;
        feedbackEl.classList.remove('hidden', 'bg-red-50', 'text-red-900', 'border-red-200');
        feedbackEl.classList.add('bg-green-50', 'text-green-900', 'border', 'border-green-200', 'block');
        
        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ—è—Å–Ω–µ–Ω–Ω—è
        explainEl.innerHTML = `**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:** ${LEVELS[currentLevelIndex].explain}`;
        explainEl.classList.remove('hidden');

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–∞—Ö—É–Ω–∫—É
        score += hintUsed ? 5 : 10;
        tries = 0; // –°–∫–∏–¥–∞—î–º–æ —Å–ø—Ä–æ–±–∏
        updateStats();

        nextBtn.disabled = false;
        checkBtn.disabled = true;

      } else {
        // --- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å ---
        tries++;
        updateStats();

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–≥—É–∫—É –ø—Ä–æ –ø–æ–º–∏–ª–∫—É
        feedbackEl.innerHTML = `‚ùå **–ü–æ–º–∏–ª–∫–∞!** –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑ –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –ø—ñ–¥–∫–∞–∑–∫—É.`;
        feedbackEl.classList.remove('hidden', 'bg-green-50', 'text-green-900', 'border-green-200');
        feedbackEl.classList.add('bg-red-50', 'text-red-900', 'border', 'border-red-200', 'block');
        explainEl.classList.add('hidden');

        // –ü—ñ–¥—Å–≤—ñ—á—É—î–º–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ —Å–ª–æ–≤–∞ —á–µ—Ä–≤–æ–Ω–∏–º
        Array.from(asmEl.children).forEach((token, index) => {
          if (token.textContent !== correctWords[index]) {
            token.classList.add('bad');
          }
        });

        // –Ø–∫—â–æ 5 —Å–ø—Ä–æ–± ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å
        if (tries >= 5) {
            showCorrectAnswer();
        }
      }
    }

    function showCorrectAnswer() {
        canCheck = false;
        const correctSentence = LEVELS[currentLevelIndex].text;

        feedbackEl.innerHTML = `üí° **–í—ñ–¥–ø–æ–≤—ñ–¥—å:** –ü—Ä–∞–≤–∏–ª—å–Ω–∏–π –≤–∏—Å–ª—ñ–≤: *${correctSentence}* (–û—á–∫–∏ –Ω–µ –∑–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ).`;
        feedbackEl.classList.remove('bg-red-50', 'text-red-900', 'border-red-200');
        feedbackEl.classList.add('bg-yellow-100', 'text-yellow-900', 'border-yellow-300');

        explainEl.innerHTML = `**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:** ${LEVELS[currentLevelIndex].explain}`;
        explainEl.classList.remove('hidden');

        // –ë–ª–æ–∫—É—î–º–æ —Ä–æ–±–æ—á—É –æ–±–ª–∞—Å—Ç—å —ñ –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏/–ø—ñ–¥–∫–∞–∑–∫–∏
        asmEl.innerHTML = ''; // –û—á–∏—â–∞—î–º–æ –∑—ñ–±—Ä–∞–Ω–µ –ø–æ–ª–µ
        poolEl.innerHTML = ''; // –û—á–∏—â–∞—î–º–æ –ø—É–ª
        nextBtn.disabled = false;
        checkBtn.disabled = true;
        hintBtn.disabled = true;
    }
    
    function useHint() {
        if (hintUsed || tries < HINT_AFTER_TRIES) return;
        
        hintUsed = true;
        score -= 2; // –®—Ç—Ä–∞—Ñ –∑–∞ –ø—ñ–¥–∫–∞–∑–∫—É
        updateStats();

        const correctWords = tokenise(LEVELS[currentLevelIndex].text);
        const currentWords = Array.from(asmEl.children).map(c => c.textContent);
        
        // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –ø–µ—Ä—à–µ —Å–ª–æ–≤–æ, —è–∫–µ —Å—Ç–æ—ó—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
        let incorrectToken = null;
        let correctNextWord = null;

        if (asmEl.children.length === 0) {
            // –Ø–∫—â–æ –ø–æ–ª–µ –ø–æ—Ä–æ–∂–Ω—î, –ø–æ–∫–∞–∑—É—î–º–æ –ø–µ—Ä—à–µ —Å–ª–æ–≤–æ
            correctNextWord = correctWords[0];
        } else {
            // –®—É–∫–∞—î–º–æ –ø–µ—Ä—à–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–µ —Å–ª–æ–≤–æ, —è–∫–µ —Å—Ç–æ—ó—Ç—å –Ω–∞ —Å–≤–æ—î–º—É –º—ñ—Å—Ü—ñ
            for (let i = 0; i < currentWords.length; i++) {
                if (currentWords[i] !== correctWords[i]) {
                    incorrectToken = asmEl.children[i];
                    correctNextWord = correctWords[i]; // –¶–µ —Å–ª–æ–≤–æ, —è–∫–µ –º–∞—î –±—É—Ç–∏ –Ω–∞ —Ü—ñ–π –ø–æ–∑–∏—Ü—ñ—ó
                    break;
                }
            }
            // –Ø–∫—â–æ –≤—Å—ñ –∑—ñ–±—Ä–∞–Ω—ñ —Å–ª–æ–≤–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ, –ø–æ–∫–∞–∑—É—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω–µ —Å–ª–æ–≤–æ
            if (!incorrectToken && currentWords.length < correctWords.length) {
                correctNextWord = correctWords[currentWords.length];
            }
        }
        
        if (correctNextWord) {
            feedbackEl.innerHTML = `üí° **–ü—ñ–¥–∫–∞–∑–∫–∞:** –ù–∞—Å—Ç—É–ø–Ω–µ (–∞–±–æ –ø–µ—Ä—à–µ) —Å–ª–æ–≤–æ ‚Äî —Ü–µ **${correctNextWord}**. (–®—Ç—Ä–∞—Ñ: -2 –æ—á–∫–∏)`;
            feedbackEl.classList.remove('hidden', 'bg-red-50', 'text-red-900', 'border-red-200');
            feedbackEl.classList.add('bg-yellow-100', 'text-yellow-900', 'border', 'border-yellow-300', 'block');
        } else if (asmEl.children.length === correctWords.length) {
             feedbackEl.innerHTML = `üí° **–ü—ñ–¥–∫–∞–∑–∫–∞:** –í–∏ –∑—ñ–±—Ä–∞–ª–∏ –≤—Å—ñ —Å–ª–æ–≤–∞. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏'!`;
             feedbackEl.classList.add('bg-yellow-100', 'text-yellow-900', 'border-yellow-300', 'block');
        }

        hintBtn.disabled = true; // –í–∏–º–∏–∫–∞—î–º–æ –ø—ñ–¥–∫–∞–∑–∫—É –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è
    }

    function nextLevel() {
      currentLevelIndex++;
      if (currentLevelIndex < LEVELS.length) {
        drawLevel();
      } else {
        showFinalScore();
      }
    }
    
    function showFinalScore() {
        // –ë–ª–æ–∫—É—î–º–æ —ñ–≥—Ä–æ–≤—É –æ–±–ª–∞—Å—Ç—å
        poolEl.innerHTML = '';
        asmEl.innerHTML = '';
        checkBtn.disabled = true;
        nextBtn.disabled = true;
        shuffleBtn.disabled = true;
        hintBtn.disabled = true;

        // –ü–æ–∫–∞–∑ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
        feedbackEl.classList.remove('hidden', 'bg-red-50', 'text-red-900', 'border-red-200');
        feedbackEl.classList.add('bg-blue-100', 'text-blue-900', 'border-blue-300', 'block');
        feedbackEl.innerHTML = `üéâ **–ö–≤–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ!** –í–∏ –Ω–∞–±—Ä–∞–ª–∏ **${score}** –æ—á–æ–∫. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å '–ü–æ—á–∞—Ç–∏ –∑–∞–Ω–æ–≤–æ', —â–æ–± —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑!`;

        explainEl.classList.add('hidden');
        levelChip.textContent = `10 / 10 (–§–Ü–ù–ê–õ)`;
    }

    function restartGame() {
        currentLevelIndex = 0;
        score = 0;
        tries = 0;
        shuffleBtn.disabled = false;
        restartBtn.disabled = false; // –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –∫–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É –∞–∫—Ç–∏–≤–Ω–∞
        drawLevel();
    }

    // --- –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π ---
    checkBtn.onclick = checkAnswer;
    nextBtn.onclick = nextLevel;
    shuffleBtn.onclick = drawLevel; // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å
    hintBtn.onclick = useHint;
    restartBtn.onclick = restartGame;


    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
    drawLevel();
  </script>
</body>
</html>
